(()=>{"use strict";const e={click:"../../files/sounds/click.mp3",flag:"../../files/sounds/flag.mp3","flag-off":"../../files/sounds/flag-off.mp3",win:"../../files/sounds/win.mp3",lose:"../../files/sounds/lose.mp3"};let t=!0,s=!1,a=!1,c=!1,i=0,n=0,d="",o="";function l(){h.forEach((e=>{e.forEach((e=>{e.isBomb&&e.openBomb()}))}))}function r(e){const{x:t,y:s}=e,a=[];return t>0&&h[t-1][s]&&a.push(h[t-1][s]),t<k-1&&h[t+1][s]&&a.push(h[t+1][s]),s>0&&h[t][s-1]&&a.push(h[t][s-1]),s<p-1&&h[t][s+1]&&a.push(h[t][s+1]),t>0&&s>0&&h[t-1][s-1]&&a.push(h[t-1][s-1]),t>0&&s<=p-1&&h[t-1][s+1]&&a.push(h[t-1][s+1]),t<k-1&&s>0&&h[t+1][s-1]&&a.push(h[t+1][s-1]),t<k-1&&s<p-1&&h[t+1][s+1]&&a.push(h[t+1][s+1]),a}function m(){c=!0,window.timer=window.setInterval((()=>{d.textContent++}),1e3)}function u(e){const t=document.querySelector(".game__result"),s=document.querySelector(".result__status"),a=document.querySelector(".result__time"),c=document.querySelector(".result__clicks");t.classList.add("show"),s.textContent=`${e}!`,s.classList.add(`${e.toLowerCase()}`),a.textContent=`Time: ${d.textContent} sec`,c.textContent=`Clicks: ${n}`}function L(t){new Audio(e[t]).play()}class v{constructor(e,t){this.isBomb=e,this.coordinates=t}setFlag(e){if(this.isOpen)return;const t=parseInt(o.textContent);if(e){if(!(t>0))return;this.isFlagged=e,this.cell.innerHTML='<img src="./img/flag.png" alt="flag">',o.textContent--,L("flag")}else this.isFlagged=e,this.cell.innerHTML="",o.textContent++,L("flag-off")}setValue(e){this.value=e}countBombs(){if(this.isBomb)return;const e=r(this.coordinates);let t=0;e.forEach((e=>{(1===e||e.isBomb)&&t++})),t&&(this.setValue(t),this.cell.classList.add(`color--${this.value}`))}open(){this.isOpen=!0,this.cell.classList.add("opened"),this.showValue()}openBomb(){this.isOpen=!0,this.cell.classList.add("opened"),this.cell.innerHTML='<img src="./img/bomb.png" alt="bomb">'}showValue(){this.cell.innerHTML=this.value?this.value:""}onClick(){if(!s&&!a)if(this.isFlagged||this.isOpen)n--;else{if(c||m(),t&&(t=!1,function(e,t){for(;e;){const s=g(0,k-1),a=g(0,p-1);h[s][a].isBomb||t.x===s||t.y===a||(h[s][a].isBomb=!0,e--)}h.forEach((e=>{e.forEach((e=>{e.countBombs()}))}))}(_,this.coordinates)),this.isBomb){document.querySelector(".header__restart").innerHTML='<button><img src="./img/sad-face.png" alt="smile"></button>';const e=d.textContent;return 10===E.length&&E.shift(),E.push(`Lose (${e} sec, ${n} clicks)`),localStorage.setItem("records",E.join(" - ")),this.cell.classList.add("lose"),this.openBomb(),l(),u("Lose"),L("lose"),s=!0,void window.clearInterval(window.timer)}if(!this.value&&!this.isOpen){this.open();r(this.coordinates).forEach((e=>{e.isOpen||e.onClick()}))}if(i--,!i){const e=d.textContent;10===E.length&&E.shift(),E.push(`Win (${e} sec, ${n} clicks)`),localStorage.setItem("records",E.join(" - ")),a=!0,l(),u("Win"),L("win"),window.clearInterval(window.timer)}this.open()}}createCellMarkup(){const e=document.createElement("div");return e.classList.add("field__cell"),25===k&&e.classList.add("small"),this.cell=e,this.cell.addEventListener("contextmenu",(e=>{e.preventDefault(),s||a||(c||m(),this.isFlagged?this.setFlag(!1):this.setFlag(!0))})),this.cell.addEventListener("click",(()=>{this.isOpen||this.isFlagged||this.isBomb||s||a||L("click"),n++,this.onClick()})),e}}const g=(e,t)=>Math.floor(Math.random()*(t-e+1))+e;let h=[],k=10,p=10,_=10,f=k*p-_,E=[];const b='<button><img src="./img/smile-face.png" alt="smile"></button>';function y(){const e=document.createElement("div");e.classList.add("wrapper");const t=document.createElement("main");t.classList.add("page");const s=document.createElement("section");s.classList.add("game");const a=document.createElement("div");a.classList.add("game__container");const c=document.createElement("div");c.classList.add("game__body");const i=document.createElement("div");i.classList.add("game__header");const n=document.createElement("div");n.className="header__bombs display",n.textContent=_;const d=document.createElement("div");d.classList.add("header__restart"),d.innerHTML=b,d.addEventListener("click",(()=>C(k,p,_)));const o=document.createElement("div");o.className="header__timer display",o.textContent=0,i.append(n,d,o);const l=document.createElement("div");l.classList.add("game__field"),l.innerHTML="";const r=document.createElement("div");r.classList.add("field__body"),h.map(((e,t)=>{const s=document.createElement("div");return s.classList.add("field__row"),e=e.map(((e,a)=>{h[t][a]=function(e,t){return new v(e,t)}(function(e){return 1===e}(h[t][a]),{x:t,y:a});const c=h[t][a].createCellMarkup();return s.appendChild(c),h[t][a]})),r.appendChild(s),e})),l.appendChild(r);const m=document.createElement("div");m.classList.add("game__result");const u=document.createElement("div");u.classList.add("result__body");const L=document.createElement("div");L.classList.add("result__status"),L.textContent="Win!";const g=document.createElement("div");g.classList.add("result__time"),g.textContent="Time: ";const f=document.createElement("div");f.classList.add("result__clicks"),f.textContent="Clicks: ",u.append(L,g,f),m.appendChild(u);const y=document.createElement("section");y.classList.add("settings");const w=document.createElement("div");w.classList.add("settings__button"),w.innerHTML='<img src="./img/settings.svg" alt="settings-icon">',w.addEventListener("click",(e=>{x.classList.toggle("opened")}));const x=document.createElement("div");x.classList.add("settings__body");const S=document.createElement("div");S.classList.add("settings__difficulty");const M=document.createElement("button");M.className="difficulty__option active",M.textContent="Easy",M.addEventListener("click",(e=>{localStorage.setItem("difficulty","easy"),k=10,p=10,_=10,A.value=_,C(k,p,_)}));const T=document.createElement("span");T.textContent=" / ";const H=document.createElement("button");H.classList.add("difficulty__option"),H.textContent="Medium",H.addEventListener("click",(e=>{localStorage.setItem("difficulty","medium"),k=15,p=15,_=40,A.value=_,C(k,p,_)}));const q=document.createElement("span");q.textContent=" / ";const I=document.createElement("button");I.classList.add("difficulty__option"),I.textContent="Hard",I.addEventListener("click",(e=>{localStorage.setItem("difficulty","hard"),k=25,p=25,_=99,A.value=_,C(k,p,_)}));const B=localStorage.getItem("difficulty");[M,H,I].forEach((e=>{B&&e.classList.remove("active"),e.textContent.toLowerCase()===B&&e.classList.add("active")})),S.append(M,T,H,q,I);const $=document.createElement("div");$.classList.add("settings__bombs"),$.innerHTML=`Bombs:\n\t<input type="number" name="bombs" min="10" max="99" value="${_}" class="input">`;const A=$.children[0];A.addEventListener("change",(e=>{_="easy"===B&&A.value>40?40:"medium"===B&&A.value>85?85:A.value,C(k,p,_)}));const F=document.createElement("button");F.classList.add("settings__records"),F.textContent="Show records",F.addEventListener("click",(e=>{W.classList.add("opened")}));const N=document.createElement("div");N.classList.add("settings__theme");const O=document.createElement("button");O.className="theme__option active",O.textContent="Light",O.addEventListener("click",(e=>{t.classList.remove("dark"),c.classList.remove("dark"),i.classList.remove("dark"),n.classList.remove("dark"),d.classList.remove("dark"),o.classList.remove("dark"),r.classList.remove("dark"),u.classList.remove("dark"),x.classList.remove("dark"),M.classList.remove("dark"),H.classList.remove("dark"),I.classList.remove("dark"),j.classList.remove("dark"),j.classList.remove("active"),O.className="dark active",A.classList.remove("dark"),z.classList.remove("dark");document.querySelectorAll(".field__cell").forEach((e=>{e.classList.remove("dark")}));document.querySelectorAll(".records__item").forEach((e=>{e.classList.remove("dark")})),w.innerHTML='<img src="./img/settings.svg" alt="settings-icon">',G.innerHTML='<img src="./img/cross.svg" alt="cross">',localStorage.setItem("theme","light")}));const V=document.createElement("span");V.textContent=" / ";const j=document.createElement("button");j.classList.add("theme__option"),j.textContent="Dark",j.addEventListener("click",(e=>{t.classList.add("dark"),c.classList.add("dark"),i.classList.add("dark"),n.classList.add("dark"),d.classList.add("dark"),o.classList.add("dark"),r.classList.add("dark"),u.classList.add("dark"),x.classList.add("dark"),M.classList.add("dark"),H.classList.add("dark"),I.classList.add("dark"),O.classList.add("dark"),O.classList.remove("active"),j.className="dark active",A.classList.add("dark"),z.classList.add("dark");document.querySelectorAll(".field__cell").forEach((e=>{e.classList.add("dark")}));document.querySelectorAll(".records__item").forEach((e=>{e.classList.add("dark")})),w.innerHTML='<img src="./img/settings-dark.svg" alt="settings-icon">',G.innerHTML='<img src="./img/cross-dark.svg" alt="cross">',localStorage.setItem("theme","dark")})),N.append(O,V,j),x.append(S,$,F,N),y.append(w,x),document.addEventListener("click",(e=>{e.target.closest(".settings__body")||e.target.closest(".settings__button")||x.classList.remove("opened")}));const W=document.createElement("section");W.classList.add("records"),W.addEventListener("click",(e=>{e.target.closest("records__content")||W.classList.remove("opened")}));const D=document.createElement("div");D.classList.add("records__body");const z=document.createElement("div");z.classList.add("records__content");const G=document.createElement("div");G.classList.add("records__close"),G.innerHTML='<img src="./img/cross.svg" alt="cross">',G.addEventListener("click",(e=>{W.classList.remove("opened")}));const J=document.createElement("ul");J.classList.add("records__list"),E.forEach(((e,t)=>{const s=document.createElement("li");s.classList.add("records__item"),s.textContent=`${t+1}. ${e} `,J.appendChild(s)})),z.append(G,J),D.appendChild(z),W.appendChild(D),c.append(i,l),a.append(c,m),s.appendChild(a),t.append(s,y,W),e.appendChild(t),document.body.insertAdjacentElement("afterbegin",e);const K=localStorage.getItem("theme");if(K)switch(K){case"light":t.classList.remove("dark"),c.classList.remove("dark"),i.classList.remove("dark"),n.classList.remove("dark"),d.classList.remove("dark"),o.classList.remove("dark"),r.classList.remove("dark"),u.classList.remove("dark"),x.classList.remove("dark"),M.classList.remove("dark"),H.classList.remove("dark"),I.classList.remove("dark"),j.classList.remove("dark"),j.classList.remove("active"),O.className="dark active",A.classList.remove("dark"),z.classList.remove("dark");document.querySelectorAll(".field__cell").forEach((e=>{e.classList.remove("dark")}));document.querySelectorAll(".records__item").forEach((e=>{e.classList.remove("dark")})),w.innerHTML='<img src="./img/settings.svg" alt="settings-icon">',G.innerHTML='<img src="./img/cross.svg" alt="cross">';break;case"dark":t.classList.add("dark"),c.classList.add("dark"),i.classList.add("dark"),n.classList.add("dark"),d.classList.add("dark"),o.classList.add("dark"),r.classList.add("dark"),u.classList.add("dark"),x.classList.add("dark"),M.classList.add("dark"),H.classList.add("dark"),I.classList.add("dark"),O.classList.add("dark"),O.classList.remove("active"),j.className="dark active",A.classList.add("dark"),z.classList.add("dark");document.querySelectorAll(".field__cell").forEach((e=>{e.classList.add("dark")}));document.querySelectorAll(".records__item").forEach((e=>{e.classList.add("dark")})),w.innerHTML='<img src="./img/settings-dark.svg" alt="settings-icon">',G.innerHTML='<img src="./img/cross-dark.svg" alt="cross">';break}}function C(e=10,l=10,r=10){document.body.innerHTML="",f=e*l-r,window.clearInterval(window.timer),function(e,t){h=Array.from({length:t},(()=>Array.from({length:e})),(()=>!1))}(e,l),y(),d=document.querySelector(".header__timer"),o=document.querySelector(".header__bombs-count"),a=!1,s=!1,n=0,t=!0,c=!1,i=f}window.addEventListener("load",(function(){const e=localStorage.getItem("records"),t=document.querySelector(".records__list");e&&(E=e.split(" - "),E.forEach(((e,s)=>{const a=document.createElement("li");a.classList.add("records__item"),a.textContent=`${s+1}. ${e}`,t.appendChild(a)})));const s=localStorage.getItem("difficulty");if(s){const e=document.querySelector(".input");switch(s){case"easy":k=10,p=10,_=10,e.value=_,C(k,p,_);break;case"medium":k=15,p=15,_=40,e.value=_,C(k,p,_);break;case"hard":k=25,p=25,_=99,e.value=_,C(k,p,_)}}document.querySelectorAll(".difficulty__option").forEach((e=>{e.classList.remove("active"),e.textContent.toLowerCase()===s&&e.classList.add("active")}))})),C()})();